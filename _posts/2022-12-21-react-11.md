---
title: "Uncaught (in promise) Error: Invariant failed: A state mutation was detected between dispatches"
author: surfharu
date: 2022-12-21 09:00:00 +0800
categories: [react]
tags: [react, error] # TAG names should always be lowercase
---


> Uncaught (in promise) Error: Invariant failed: A state mutation was detected between dispatches ...
{: .prompt-danger }

## Error Code
```js
import { useSelector, useDispatch } from 'react-redux';
import { resetTemplate, selectTemplate } from './AssignSlice';

/**
 * template 
 * {name:'template name', items: [{text: 'apple'}]}
 **/
const template = useSelector(selectTemplate);

useEffect(() => {
    template.items.forEach(item => {
        item.text = 'orange';
    });
}, []);
```


## Solution
`redux`에 저장된 값을 직접 변경하였기 때문에 발생한 오류이다. 변경 시는 `dispatch`를 이용하여야 한다.  
redux 에서 가져 온 값을 직접 변경하여 사용하려는 경우 `값을 복사`하여 사용 하도록 한다.

```js
import loadash from 'lodash';

const template = useSelector(selectTemplate);
const templateCopy = loadash.cloneDeep(template.items);  // 복사

useEffect(() => {
    templateCopy.forEach(item => {
        item.text = 'orange';
    });
}, []);

```